$( document ).ready( function() {
	
	// The following code is only called on the index page of the appointments controller
	if( $( 'body.appointments').length && $( 'body.index' ).length ) {
		$( '#calendar' ).fullCalendar({
			defaultView: 'agendaWeek',
			doctorsSource: '/doctors/list',
			eventSources: ['/appointments/findByDate'],
			allDaySlot: false,
			minTime: '7:30am',
			maxTime: '6:00pm',
			slotMinutes: 10,
            selectable: true,
            selectHelper: true,
            eventClick: function(calEvent, jsEvent, view, start, end) {
                alert('Event: ' + calEvent.title + start + end);
                // change the border color just for fun
                $(this).css('border-color', 'red');
            },
            dayClick: function(date, start, end, allDay) {
                var title = $( "#title").text();
                $('#add-event').dialog();
                var eventData;
                if (title) {
                    $( "#calendar" ).fullCalendar('renderEvent',
                            {
                                date: date,
                                title: title,
                                start: start,
                                end: end,
                                allDay: allDay
                            },
                            true // make the event "stick"
                    );
                    $( "#dialog-confirm" ).dialog({
                        resizable: false,
                        height:140,
                        modal: true,
                        buttons: {
                            "Confirm": function() {
                                $( this ).dialog( "submit" );
                            }
                        }
                    });
                    $.ajax({
                        url: '/Calendar/EventsAJAX',
                        date: date,
                        title: title,
                        start:start,
                        end: end,
                        allday: allday,
                    }).done(function() {
                                alert("done");
                            });

                    jQuery.post(
                            "appointments/new.html.erb" // your url
                            , { // re-use event's data
                                date: date,
                                title: title,
                                start: start,
                                end: end,
                                allDay: allDay
                            }
                    );
                }
                $( "#calendar" ).fullCalendar('unselect');
            }
        });

        $("#search").autocomplete({
            source: "/doctors/search"
        });
        $("#find ").autocomplete({
            source: "/doctors/search"
        });
        $( "#date").datepicker();

        $( "#start-time").timepicker();
        $( "#end-time").timepicker();
	}
	
	// New appointment page
	if( $( 'body.appointments' ).length && $( 'body.new' ).length ) {
        $("#appointment_doctor").autocomplete({
            source: "/doctors/search"
        })
		
        $( "#appointment_date").datepicker();

        $( "#appointment_start_time").timepicker();
	}
	
});
