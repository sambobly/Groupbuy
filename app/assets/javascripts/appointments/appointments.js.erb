$( document ).ready( function() {
	
	// The following code is only called on the index page of the appointments controller
	if( $( 'body.appointments').length && $( 'body.index' ).length ) {
		$( '#calendar' ).fullCalendar({
			defaultView: 'agendaWeek',
			doctorsSource: '/doctors/list',
			eventSources: ['/appointments/findByDate'],
			allDaySlot: false,
			minTime: '7:30am',
			maxTime: '6:00pm',
			slotMinutes: 10,
            selectable: true,
            selectHelper: true,
            dayClick: function(start, end, allDay) {
                // var title = prompt('Create appointment' + "appointments/new.html.erb");
                $('#eventToAdd').dialog();
                var eventData;
                if (title) {
                    calendar.fullCalendar('renderEvent',
                            {
                                title: title,
                                start: start,
                                end: end,
                                allDay: allDay
                            },
                            true // make the event "stick"
                    );
                    /**
                     * ajax call to store event in DB
                     */
                    jQuery.post(
                            "appointments/new.html.erb" // your url
                            , { // re-use event's data
                                title: title,
                                start: start,
                                end: end,
                                allDay: allDay
                            }
                    );
                }
                calendar.fullCalendar('unselect');
            }
        });

        $("#search").autocomplete({
            source: "/doctors/search"
        });
        $("#find ").autocomplete({
            source: "/doctors/search"
        });
        $( "#date").datepicker();
	}
	
	// New appointment page
	if( $( 'body.appointments' ).length && $( 'body.new' ).length ) {
        $("#appointment_doctor").autocomplete({
            source: "/doctors/search"
        })
		
        $( "#appointment_date").datepicker();

        $( "#appointment_start_time").timepicker();
	}
	
});
